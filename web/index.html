<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mailtagger Prompt Manager</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“§ Mailtagger Prompt Manager</h1>
            <p class="subtitle">Manage and test your email classification prompts</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="tabs">
            <button class="tab-button active" onclick="showTab('edit')">
                âœï¸ Edit Prompt
            </button>
            <button class="tab-button" onclick="showTab('test')">
                ğŸ§ª Test
            </button>
            <button class="tab-button" onclick="showTab('stats')">
                ğŸ“Š Statistics
            </button>
            <button class="tab-button" onclick="showTab('gmail')">
                ğŸ” Gmail Auth
            </button>
        </nav>

        <!-- Edit Tab -->
        <div id="edit-tab" class="tab-content active">
            <div class="card">
                <h2>Edit Classification Prompt</h2>
                <div class="form-group">
                    <label for="prompt-name">Prompt Name:</label>
                    <input type="text" id="prompt-name" placeholder="e.g., Enhanced Classifier v2">
                </div>
                <div class="form-group">
                    <label for="prompt-content">Prompt Content:</label>
                    <textarea 
                        id="prompt-content" 
                        placeholder="Enter your classification prompt here..."
                        rows="20"
                    ></textarea>
                    <p class="help-text">
                        The prompt should instruct the LLM to classify emails into: 
                        <code>ecommerce</code>, <code>political</code>, or <code>none</code>
                    </p>
                </div>
                <div class="button-group">
                    <button class="button button-primary" onclick="savePrompt()">
                        ğŸ’¾ Save & Activate
                    </button>
                    <button class="button" onclick="loadPrompt()">
                        ğŸ”„ Reload
                    </button>
                </div>
                <div id="save-status"></div>
            </div>
        </div>

        <!-- Test Tab -->
        <div id="test-tab" class="tab-content">
            <div class="card">
                <h2>Test Prompt on Real Emails</h2>
                <div class="test-config">
                    <div class="form-group inline">
                        <label for="email-count">Number of emails:</label>
                        <input type="number" id="email-count" value="10" min="1" max="50">
                    </div>
                    <div class="form-group inline">
                        <label for="test-query">Gmail Query:</label>
                        <input type="text" id="test-query" placeholder="in:inbox newer_than:7d">
                        <p class="help-text-small">Leave empty to use default</p>
                    </div>
                    <button class="button button-primary" onclick="runTest()">
                        ğŸ§ª Run Test
                    </button>
                </div>

                <div id="test-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Testing prompt on emails... This may take a minute.</p>
                </div>

                <div id="test-results"></div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="card">
                <h2>Performance Statistics</h2>
                <div class="form-group inline">
                    <label for="stats-days">Time period:</label>
                    <select id="stats-days" onchange="loadStats()">
                        <option value="1">Last 24 hours</option>
                        <option value="7" selected>Last 7 days</option>
                        <option value="30">Last 30 days</option>
                    </select>
                    <button class="button button-small" onclick="loadStats()">
                        ğŸ”„ Refresh
                    </button>
                </div>
                
                <div id="stats-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading statistics...</p>
                </div>

                <div id="stats-display"></div>
            </div>
        </div>

        <!-- Gmail Auth Tab -->
        <div id="gmail-tab" class="tab-content">
            <div class="card">
                <h2>Gmail Authorization</h2>
                <p class="help-text">
                    Mailtagger needs access to your Gmail account to read and label emails.
                    Your credentials are stored securely on your server only.
                </p>

                <div id="gmail-status-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Checking authorization status...</p>
                </div>

                <div id="gmail-auth-status"></div>

                <div class="button-group" style="margin-top: 20px;">
                    <button class="button button-primary" id="authorize-button" onclick="authorizeGmail()" style="display: none;">
                        ğŸ” Authorize Gmail
                    </button>
                    <button class="button button-danger" id="revoke-button" onclick="revokeGmail()" style="display: none;">
                        ğŸš« Revoke Authorization
                    </button>
                    <button class="button" onclick="checkGmailStatus()">
                        ğŸ”„ Refresh Status
                    </button>
                </div>

                <div id="gmail-action-status" style="margin-top: 15px;"></div>

                <div class="card" style="margin-top: 30px; background: #f8f9fa;">
                    <h3>ğŸ“‹ Setup Instructions</h3>
                    <ol style="line-height: 1.8;">
                        <li>
                            <strong>Create Google Cloud Project:</strong>
                            <br>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>
                            and create a new project.
                        </li>
                        <li>
                            <strong>Enable Gmail API:</strong>
                            <br>In your project, go to "APIs & Services" â†’ "Library" â†’ Search "Gmail API" â†’ Enable
                        </li>
                        <li>
                            <strong>Create OAuth Credentials:</strong>
                            <br>Go to "APIs & Services" â†’ "Credentials" â†’ "Create Credentials" â†’ "OAuth client ID"
                            <br>Application type: "Web application"
                            <br>Authorized redirect URIs: Add your server URL + <code>/api/oauth/callback</code>
                            <br>Example: <code>https://hanweir.146sharon.com/api/oauth/callback</code>
                        </li>
                        <li>
                            <strong>Download credentials.json:</strong>
                            <br>Download the OAuth client JSON file and save it as <code>credentials.json</code>
                            on your server at <code>/opt/mailtagger/credentials.json</code>
                        </li>
                        <li>
                            <strong>Click "Authorize Gmail" above:</strong>
                            <br>This will redirect you to Google to grant permissions.
                        </li>
                    </ol>
                    <p class="help-text" style="margin-top: 15px;">
                        <strong>Note:</strong> The OAuth credentials must have your server's URL 
                        as an authorized redirect URI in Google Cloud Console.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

